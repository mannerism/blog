---
title:  "ë°±ì—”ë“œ ì‹œë¦¬ì¦ˆ 3. DB ë§ˆì´ê·¸ë ˆì´ì…˜"
date:   2021-07-31 12:27:19 +0900
permalink: ":categories/backend/:title"
---

> ì›ë¬¸ ì¶œì²˜: [Techschool](https://www.youtube.com/watch?v=rx6CPDK_5mU&list=PLy_6D98if3ULEtXtNSY_2qN21VCKgoQAE&ab_channel=TECHSCHOOL "Tech School")

### ë°±ì—”ë“œ ì‹œë¦¬ì¦ˆ 1. DB ë§ˆì´ê·¸ë ˆì´ì…˜

ì´ë²ˆ ì‹œë¦¬ì¦ˆì—ëŠ” DB ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì§„í–‰í•´ ë³´ê² ìŠµë‹ˆë‹¤. ë°±ì—”ë“œ ê°œë°œì„ í•˜ë‹¤ë³´ë©´ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì´ ë°”ë€Œê³  DBê°€ ë°”ë€Œì–´ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ì¢…ì¢…ìˆëŠ”ë° ì´ë¥¼ ìœ„í•œ ê°•ì˜ë¼ê³  ë³´ì‹œë©´ ë©ë‹ˆë‹¤.

---

#### Golang migrate ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜

ì´ë²ˆ ì‹œë¦¬ì¦ˆì˜ DB migrationì„ ìœ„í•´ì„œ `golang migrate` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•´ ë³´ê² ìŠµë‹ˆë‹¤. [golang-migrate](https://github.com/golang-migrate/migrate) ê¹ƒí—ˆë¸Œì—ì„œ [CLI Documentation](https://github.com/golang-migrate/migrate/tree/master/cmd/migrate)ì— ì„¤ëª…ëœ ëŒ€ë¡œ ì„¤ì¹˜ë¥¼ ì‹œì‘í•´ ë³´ê² ìŠµë‹ˆë‹¤.

`homebrew` íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €ë¥¼ í†µí•œ ì„¤ì¹˜ ë°©ë²•:

ì…ë ¥:

  ```zsh
    brew install golang-migrate
  ```

ì¶œë ¥:

  ```zsh
    ...
    ==> Pouring golang-migrate--4.14.1.big_sur.bottle.tar.gz
    ğŸº  /usr/local/Cellar/golang-migrate/4.14.1: 5 files, 37.6MB
  ```

ì„¤ì¹˜ê°€ ì™„ë£Œë˜ë©´ ì œëŒ€ë¡œ ì„¤ì¹˜ê°€ ë˜ì—ˆëŠ”ì§€ í•œë²ˆ í™•ì¸í•´ ë´…ì‹œë‹¤.

ì…ë ¥:

  ```zsh
    migrate -version
  ```

ì¶œë ¥:

  ```zsh
    v4.14.1
  ```

ì„¤ì¹˜ëœ ë²„ì „ì´ ì •ìƒì ìœ¼ë¡œ ëœ¨ëŠ”ê²ƒì„ ë³´ë‹ˆ ì œëŒ€ë¡œ ì„¤ì¹˜ê°€ ëœê±¸ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

#### Simple Bank í”„ë¡œì íŠ¸ í´ë” ìƒì„±

ì´ì œ ë³¸ê²©ì ìœ¼ë¡œ ë³¸ ì‹œë¦¬ì¦ˆì˜ ë©”ì¸ í”„ë¡œì íŠ¸ í´ë”ë¥¼ ìƒì„±í•˜ì—¬ í•˜ë‚˜ì”© ë§Œë“¤ì–´ ë‚˜ê°€ë³´ê² ìŠµë‹ˆë‹¤. í”„ë¡œì íŠ¸ í´ë”ì˜ ìœ„ì¹˜ëŠ” ê°œì¸ì˜ ê¸°í˜¸ì— ë§ê²Œ ì•Œì•„ì„œ ì§„í–‰í•˜ë©´ ë©ë‹ˆë‹¤. ë°°ê²½í™”ë©´ì— ë‘¬ë„ ë˜ê³  ì‚¬ìš©ì í´ë”ì•ˆì— ë‘¬ë„ ë©ë‹ˆë‹¤. ì €ê°™ì€ ê²½ìš° `~/dev` í´ë”ë¥¼ ë§Œë“¤ì–´ ë‘ê³  ê·¸ ì•ˆì— ëª¨ë“  í”„ë¡œì íŠ¸ í´ë”ë¥¼ ì •ë¦¬í•´ ë‘ê³  ìˆìŠµë‹ˆë‹¤. ì»¤ë©˜ë“œ ë¼ì¸ì„ ì‚¬ìš©í•˜ì—¬ `simplebank` í´ë”ë¥¼ ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤.

ì…ë ¥:

  ```zsh
    mkdir simplebank
  ```

ì¶”ê°€ë¡œ `simplebank` í´ë” ì•ˆì—ì„œ `db/migration` í´ë”ë¥¼ ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤.

ì…ë ¥:

  ```zsh
    mkdir -p db/migration
  ```

---

#### ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ìƒì„±

`simplebank` í´ë”ì—ì„œ ì´ì „ì— ì„¤ì¹˜í•œ `migrate` ì„ ì‚¬ìš©í•´ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì„ ìƒˆë¡œ ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤.

ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ìƒì„± ì»¤ë©˜ë“œ syntax
> migrate create [-ext E] [-dir D] [-seq] [-digits N] [-format] NAME

ì…ë ¥:

  ```zsh
    migrate create -ext sql -dir db/migration -seq init_schema
  ```

ì„¤ëª…: `create` ì»¤ë©˜ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì„ ìƒì„±í•´ ì£¼ë©°, `extension`ì€ `sql`ë¡œ ì§€ì •í•´ ì¤ë‹ˆë‹¤. ë””ë ‰í† ë¦¬ëŠ” ì´ì „ì— ë§Œë“  `db/migration`ìœ¼ë¡œ ì§€ì •í•´ ì¤ë‹ˆë‹¤. `-seq` í”Œë˜ê·¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì§„í–‰í• ë•Œë§ˆë‹¤ ìˆœì°¨ì ìœ¼ë¡œ ë²„ì „ì´ í•˜ë‚˜ì”© ì˜¬ë¼ê°€ë„ë¡ ì •í•´ì¤ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì´ë²ˆ ë§ˆì´ê·¸ë ˆì´ì…˜ì˜ ì´ë¦„ìœ¼ë¡œ `init_schema`ë¥¼ ì ì–´ì¤ë‹ˆë‹¤.

ì¶œë ¥:

  ```zsh
    /Users/sukyu/dev/simplebank/db/migration/000001_init_schema.up.sql
    /Users/sukyu/dev/simplebank/db/migration/000001_init_schema.down.sql
  ```

ë‘ ê°œì˜ `up` `down` ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì´ ë§Œë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤. ê° íŒŒì¼ëª… ì•ì— ë²„ì „ `00001`ì´ ë¶™ì–´ìˆëŠ”ê±¸ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
